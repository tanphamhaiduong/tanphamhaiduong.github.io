webpackJsonp([27],{2674:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2777);t.default=r.a},2777:function(e,t,n){"use strict";n(228);var r,a=n(19),s=(n(135),n(74)),o=(n(1102),n(247)),u=(n(399),n(290)),i=(n(92),n(78)),c=(n(1100),n(404)),l=(n(227),n(164)),d=(n(292),n(244)),p=n(0),m=(n.n(p),n(680)),f=n(41),h=(n.n(f),n(102)),b=(n.n(h),n(93)),I=n(107),g=n(1101),y=n(108),S=n(2778),v=n(149),E=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),R=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},_=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,s){function o(e){try{i(r.next(e))}catch(e){s(e)}}function u(e){try{i(r.throw(e))}catch(e){s(e)}}function i(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,u)}i((r=r.apply(e,t||[])).next())})},$=this&&this.__generator||function(e,t){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=r[2&s[0]?"return":s[0]?"throw":"next"])&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[0,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},w=function(e){function t(t){var n=e.call(this,t)||this;return n.isHideSubmitting=function(){n.setState({isSubmitting:!1})},n.isResetProgressBar=function(){n.setState({isSubmitting:!0,progress:0,report:[]})},n.getReportData=function(e,t){var r=e.dataSourceIds,a=e.statusIds,s=e.index;return g.a.query({query:S.a,variables:{dataSourceIds:r,statusIds:a,limit:y.TABLE.ITEMS_PER_PAGE,offset:(s-1)*y.TABLE.ITEMS_PER_PAGE}}).then(function(e){var r=e.data,a=n.state,s=a.report,o=a.totalReportRecords,u=0;o>0&&(u=Math.floor(100*(r.report.length+s.length)/o)),n.setState({report:s.concat(r.report),progress:u<=100?u:0}),t()}).catch(function(e){console.error(e),t()})},n.handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields(function(e,t){return _(n,void 0,void 0,function(){var n,r,a,s,o,u,i,c=this;return $(this,function(l){switch(l.label){case 0:if(e)return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),this.isResetProgressBar(),n=t.statusIds,r=t.dataSourceIds,[4,g.a.query({query:S.c,variables:{statusIds:n,dataSourceIds:r}})];case 2:if(a=l.sent().data,(s=a.totalReportRecords)<1)return this.isHideSubmitting(),[2,d.a.info({message:"L\u1ed7i",description:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u \u0111\u1ec3 l\u1ea5y"})];for(this.setState({totalReportRecords:s}),o=m.queue(1),u=1;u<=Math.ceil(s/y.TABLE.ITEMS_PER_PAGE);u++)o.defer(this.getReportData,{dataSourceIds:r,statusIds:n,index:u});return o.awaitAll(function(){var e=c.state.report,t=Object(I.z)(e,Object(I.q)(c.props.userLoggedIn.role.permissions));c.isHideSubmitting(),Object(I.n)(t,"customers","report"+f(Date.now()).format("DDMMMYYYY").toString())}),[3,4];case 3:return i=l.sent(),console.error(i),Object(I.o)(i),[3,4];case 4:return[2]}})})})},n.state={statusIds:[0],dataSourceIds:[0],isSubmitting:!1,report:[],progress:0,totalReportRecords:0},n}return E(t,e),t.prototype.render=function(){var e={name:"/reports/group/customers",label:"B\xe1o c\xe1o nh\xf3m",breadCumData:[{id:1,text:"Trang Ch\u1ee7",link:"/"},{id:2,text:"B\xe1o c\xe1o nh\xf3m",link:"/reports/group/customers"}]},t=this.props,n=t.form,r=t.data,d=r.loading,m=r.statuses,f=r.dataSources;return p.createElement("div",null,p.createElement(l.a,{className:"content-header"},e.label,p.createElement(b.c,{breadCumData:e.breadCumData})),p.createElement(l.a,{className:"content-body animated fadeIn"},d?p.createElement(b.p,{size:"large"}):p.createElement("div",null,p.createElement(c.a,{percent:this.state.progress,status:"active"}),p.createElement(i.a,{onSubmit:this.handleSubmit},p.createElement(l.a,{gutter:16},p.createElement(u.a,{xs:24,sm:24,md:24,lg:10},p.createElement(i.a.Item,{label:"Tr\u1ea1ng th\xe1i"},n.getFieldDecorator("statusIds",{rules:[{required:!0,message:"H\xe3y nh\u1eadp tr\u1ea1ng th\xe1i"}]})(p.createElement(o.a,{mode:"multiple"},m&&m.map(function(e){return p.createElement(o.a.Option,{key:e.id,value:e.id},e.name)}))))),p.createElement(u.a,{xs:24,sm:24,md:24,lg:10},p.createElement(i.a.Item,{label:"Ngu\u1ed3n"},n.getFieldDecorator("dataSourceIds",{rules:[{required:!0,message:"H\xe3y nh\u1eadp ngu\u1ed3n"}]})(p.createElement(o.a,{mode:"multiple"},f.map(function(e){return p.createElement(o.a.Option,{key:e.id,value:e.id},e.name)}))))),p.createElement(u.a,{xs:24,sm:24,md:24,lg:4},p.createElement(i.a.Item,null,p.createElement(s.a,{type:"primary",htmlType:"submit",loading:this.state.isSubmitting,disabled:Object(I.C)(this.props)},p.createElement(a.a,{type:"download"}),"L\u1ea5y d\u1eef li\u1ec7u"))))))))},t}(p.PureComponent);t.a=Object(h.compose)(Object(v.connect)(function(e,t){return R({userLoggedIn:e.auth.userLoggedIn},t)},null),Object(h.graphql)(S.b),i.a.create())(w)},2778:function(e,t,n){"use strict";n.d(t,"b",function(){return l}),n.d(t,"a",function(){return p}),n.d(t,"c",function(){return d});var r,a,s,o=n(101),u=n.n(o),i=n(134),c=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},l=u()(r||(r=c(["\n  query StatusReportQueries {\n    dataSources {\n      id\n      name\n    }\n    statuses {\n      id\n      name\n    }\n  }\n"],["\n  query StatusReportQueries {\n    dataSources {\n      id\n      name\n    }\n    statuses {\n      id\n      name\n    }\n  }\n"]))),d=u()(a||(a=c(["\n  query TotalRecordReportQuery($statusIds: [ID!], $dataSourceIds: [ID!]) {\n    totalReportRecords(statusIds: $statusIds, dataSourceIds: $dataSourceIds)\n  }\n"],["\n  query TotalRecordReportQuery($statusIds: [ID!], $dataSourceIds: [ID!]) {\n    totalReportRecords(statusIds: $statusIds, dataSourceIds: $dataSourceIds)\n  }\n"]))),p=u()(s||(s=c(["\n  ","\n  query RecordReportQuery(\n    $statusIds: [ID!]\n    $dataSourceIds: [ID!]\n    $limit: Int!\n    $offset: Int!\n  ) {\n    report(\n      statusIds: $statusIds\n      dataSourceIds: $dataSourceIds\n      limit: $limit\n      offset: $offset\n    ) {\n      ...Customer\n      user {\n        id\n        name\n        licenseNumber\n        supervisor {\n          id\n          name\n          phoneNumber\n        }\n      }\n    }\n  }\n"],["\n  ","\n  query RecordReportQuery(\n    $statusIds: [ID!]\n    $dataSourceIds: [ID!]\n    $limit: Int!\n    $offset: Int!\n  ) {\n    report(\n      statusIds: $statusIds\n      dataSourceIds: $dataSourceIds\n      limit: $limit\n      offset: $offset\n    ) {\n      ...Customer\n      user {\n        id\n        name\n        licenseNumber\n        supervisor {\n          id\n          name\n          phoneNumber\n        }\n      }\n    }\n  }\n"])),i.c)}});