webpackJsonp([23,65],{1161:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1162);n.d(e,"queue",function(){return r.a})},1162:function(t,e,n){"use strict";e.a=l;var r=n(1163),a={};function i(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function o(t){if(!t._start)try{!function(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,n=t._tasks[e],r=n.length-1,i=n[r];n[r]=s(t,e),--t._waiting,++t._active,n=i.apply(null,n),t._tasks[e]&&(t._tasks[e]=n||a)}}(t)}catch(e){if(t._tasks[t._ended+t._active-1])u(t,e);else if(!t._data)throw e}}function s(t,e){return function(n,r){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,null==t._error&&(null!=n?u(t,n):(t._data[e]=r,t._waiting?o(t):c(t))))}}function u(t,e){var n,r=t._tasks.length;for(t._error=e,t._data=void 0,t._waiting=NaN;--r>=0;)if((n=t._tasks[r])&&(t._tasks[r]=null,n.abort))try{n.abort()}catch(e){}t._active=NaN,c(t)}function c(t){if(!t._active&&t._call){var e=t._data;t._data=void 0,t._call(t._error,e)}}function l(t){if(null==t)t=1/0;else if(!((t=+t)>=1))throw new Error("invalid concurrency");return new i(t)}i.prototype=l.prototype={constructor:i,defer:function(t){if("function"!==typeof t)throw new Error("invalid callback");if(this._call)throw new Error("defer after await");if(null!=this._error)return this;var e=r.a.call(arguments,1);return e.push(t),++this._waiting,this._tasks.push(e),o(this),this},abort:function(){return null==this._error&&u(this,new Error("abort")),this},await:function(t){if("function"!==typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=function(e,n){t.apply(null,[e].concat(n))},c(this),this},awaitAll:function(t){if("function"!==typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=t,c(this),this}}},1163:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=[].slice},2675:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2814);e.default=r.a},2814:function(t,e,n){"use strict";n(289);var r,a=n(22),i=(n(168),n(83)),o=(n(1096),n(616)),s=(n(399),n(291)),u=(n(92),n(77)),c=(n(1164),n(617)),l=(n(239),n(167)),p=(n(290),n(241)),d=n(0),f=(n.n(d),n(146)),m=(n.n(f),n(1161)),h=n(41),_=(n.n(h),n(145)),b=(n.n(_),n(224)),g=n(100),y=n(130),v=n(1179),w=n(129),I=n(2815),E=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),A=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},R=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,s)}u((r=r.apply(t,e||[])).next())})},$=this&&this.__generator||function(t,e){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},S=function(t){function e(e){var n=t.call(this,e)||this;return n.isHideSubmitting=function(){n.setState({isSubmitting:!1})},n.isResetProgressBar=function(){n.setState({isSubmitting:!0,progress:0,report:[]})},n.getReportData=function(t,e){var r=t.dateAppointment,a=t.statusIds,i=t.index;return v.a.query({query:I.b,variables:{dateAppointment:r,statusIds:a,limit:y.l.ITEMS_PER_PAGE,offset:(i-1)*y.l.ITEMS_PER_PAGE}}).then(function(t){var r=t.data,a=n.state,i=a.report,o=a.totalReportRecords,s=0;o>0&&(s=Math.floor(100*(r.report.length+i.length)/o)),n.setState({report:i.concat(r.report),progress:s<=100?s:0}),e()}).catch(function(t){console.error(t),e()})},n.handleSubmit=function(t){t.preventDefault(),n.props.form.validateFields(function(t,e){return R(n,void 0,void 0,function(){var n,r,a,i,o,s,u,c=this;return $(this,function(l){switch(l.label){case 0:if(t)return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),this.isResetProgressBar(),n=e.dateAppointment,r=f.get(this.props.data,"statusGroup.statusesInGroup","").split(","),[4,v.a.query({query:I.c,variables:{dateAppointment:n,statusIds:r}})];case 2:if(a=l.sent().data,(i=a.totalReportRecords)<1)return this.isHideSubmitting(),[2,p.a.info({message:"L\u1ed7i",description:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u \u0111\u1ec3 l\u1ea5y"})];for(this.setState({totalReportRecords:i}),o=m.queue(1),s=1;s<=Math.ceil(i/y.l.ITEMS_PER_PAGE);s++)o.defer(this.getReportData,{dateAppointment:n,statusIds:r,index:s});return o.awaitAll(function(){var t=c.state.report,e=Object(w.v)(t,Object(w.t)(c.props.userLoggedIn.role.permissions,y.e.ADMIN));c.isHideSubmitting(),Object(w.n)(e,"customers","report"+h(Date.now()).format("DDMMMYYYY").toString())}),[3,4];case 3:return u=l.sent(),console.error(u),this.isHideSubmitting(),Object(w.o)(u),[3,4];case 4:return[2]}})})})},n.state={report:[],isSubmitting:!1,progress:0,totalReportRecords:0},n}return E(e,t),e.prototype.render=function(){var t={name:"/reports/appointments",label:"Xu\u1ea5t b\xe1o c\xe1o h\u1eb9n",breadCumData:[{id:1,text:"Trang Ch\u1ee7",link:"/"},{id:2,text:"Xu\u1ea5t b\xe1o c\xe1o h\u1eb9n",link:"/reports/appointments"}]},e=this.props,n=e.form,r=e.data.loading;return d.createElement("div",null,d.createElement(l.a,{className:"content-header"},t.label,d.createElement(g.c,{breadCumData:t.breadCumData})),d.createElement(l.a,{className:"content-body animated fadeIn"},r?d.createElement(g.o,{size:"large"}):d.createElement("div",null,d.createElement(c.a,{percent:this.state.progress,status:"active"}),d.createElement(l.a,{gutter:16},d.createElement(u.a,{onSubmit:this.handleSubmit},d.createElement(s.a,{xs:24,sm:24,md:24,lg:10},d.createElement(u.a.Item,{label:"Ng\xe0y h\u1eb9n"},n.getFieldDecorator("dateAppointment")(d.createElement(o.a.RangePicker,{showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm",placeholder:["T\u1eeb","\u0110\u1ebfn"]})))),d.createElement(s.a,{xs:24,sm:24,md:24,lg:4},d.createElement(u.a.Item,null,d.createElement(i.a,{type:"primary",htmlType:"submit",loading:this.state.isSubmitting,disabled:Object(w.z)(this.props)},d.createElement(a.a,{type:"download"}),"L\u1ea5y d\u1eef li\u1ec7u"))))))))},e}(d.PureComponent);e.a=Object(_.compose)(Object(b.connect)(function(t,e){return A({userLoggedIn:t.auth.userLoggedIn},e)},null),Object(_.graphql)(I.a,{options:function(){return{variables:{name:y.k.ACCEPT_APPOINTMENT}}}}),u.a.create())(S)},2815:function(t,e,n){"use strict";n.d(e,"a",function(){return l}),n.d(e,"c",function(){return p}),n.d(e,"b",function(){return d});var r,a,i,o=n(128),s=n.n(o),u=n(160),c=this&&this.__makeTemplateObject||function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},l=s()(r||(r=c(["\n  query AppointmentsReportQueries($name: String!) {\n    statusGroup(name: $name) {\n      id\n      statusesInGroup\n    }\n  }\n"],["\n  query AppointmentsReportQueries($name: String!) {\n    statusGroup(name: $name) {\n      id\n      statusesInGroup\n    }\n  }\n"]))),p=s()(a||(a=c(["\n  query TotalRecordReportQuery($statusIds: [ID!], $dateAppointment: [String!]) {\n    totalReportRecords(statusIds: $statusIds, dateAppointment: $dateAppointment)\n  }\n"],["\n  query TotalRecordReportQuery($statusIds: [ID!], $dateAppointment: [String!]) {\n    totalReportRecords(statusIds: $statusIds, dateAppointment: $dateAppointment)\n  }\n"]))),d=s()(i||(i=c(["\n  ","\n  query ReportQuery(\n    $statusIds: [ID!]\n    $dateAppointment: [String!]\n    $limit: Int!\n    $offset: Int!\n  ) {\n    report(\n      statusIds: $statusIds\n      dateAppointment: $dateAppointment\n      limit: $limit\n      offset: $offset\n    ) {\n      ...Customer\n      user {\n        id\n        name\n        licenseNumber\n        supervisor {\n          id\n          name\n          phoneNumber\n        }\n      }\n    }\n  }\n"],["\n  ","\n  query ReportQuery(\n    $statusIds: [ID!]\n    $dateAppointment: [String!]\n    $limit: Int!\n    $offset: Int!\n  ) {\n    report(\n      statusIds: $statusIds\n      dateAppointment: $dateAppointment\n      limit: $limit\n      offset: $offset\n    ) {\n      ...Customer\n      user {\n        id\n        name\n        licenseNumber\n        supervisor {\n          id\n          name\n          phoneNumber\n        }\n      }\n    }\n  }\n"])),u.c)}});