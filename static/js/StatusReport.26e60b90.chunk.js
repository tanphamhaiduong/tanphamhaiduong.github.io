webpackJsonp([21,65],{1161:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1162);n.d(e,"queue",function(){return r.a})},1162:function(t,e,n){"use strict";e.a=l;var r=n(1163),a={};function s(t){this._size=t,this._call=this._error=null,this._tasks=[],this._data=[],this._waiting=this._active=this._ended=this._start=0}function o(t){if(!t._start)try{!function(t){for(;t._start=t._waiting&&t._active<t._size;){var e=t._ended+t._active,n=t._tasks[e],r=n.length-1,s=n[r];n[r]=i(t,e),--t._waiting,++t._active,n=s.apply(null,n),t._tasks[e]&&(t._tasks[e]=n||a)}}(t)}catch(e){if(t._tasks[t._ended+t._active-1])u(t,e);else if(!t._data)throw e}}function i(t,e){return function(n,r){t._tasks[e]&&(--t._active,++t._ended,t._tasks[e]=null,null==t._error&&(null!=n?u(t,n):(t._data[e]=r,t._waiting?o(t):c(t))))}}function u(t,e){var n,r=t._tasks.length;for(t._error=e,t._data=void 0,t._waiting=NaN;--r>=0;)if((n=t._tasks[r])&&(t._tasks[r]=null,n.abort))try{n.abort()}catch(e){}t._active=NaN,c(t)}function c(t){if(!t._active&&t._call){var e=t._data;t._data=void 0,t._call(t._error,e)}}function l(t){if(null==t)t=1/0;else if(!((t=+t)>=1))throw new Error("invalid concurrency");return new s(t)}s.prototype=l.prototype={constructor:s,defer:function(t){if("function"!==typeof t)throw new Error("invalid callback");if(this._call)throw new Error("defer after await");if(null!=this._error)return this;var e=r.a.call(arguments,1);return e.push(t),++this._waiting,this._tasks.push(e),o(this),this},abort:function(){return null==this._error&&u(this,new Error("abort")),this},await:function(t){if("function"!==typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=function(e,n){t.apply(null,[e].concat(n))},c(this),this},awaitAll:function(t){if("function"!==typeof t)throw new Error("invalid callback");if(this._call)throw new Error("multiple await");return this._call=t,c(this),this}}},1163:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=[].slice},2674:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2812);e.default=r.a},2812:function(t,e,n){"use strict";n(289);var r,a=n(22),s=(n(168),n(83)),o=(n(1097),n(246)),i=(n(399),n(291)),u=(n(92),n(77)),c=(n(1164),n(617)),l=(n(239),n(167)),d=(n(290),n(241)),f=n(0),p=(n.n(f),n(1161)),h=n(46),m=(n.n(h),n(144)),_=(n.n(m),n(100)),b=n(129),y=n(1179),I=n(145),g=n(2813),v=n(224),w=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),S=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},E=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,s){function o(t){try{u(r.next(t))}catch(t){s(t)}}function i(t){try{u(r.throw(t))}catch(t){s(t)}}function u(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,i)}u((r=r.apply(t,e||[])).next())})},R=this&&this.__generator||function(t,e){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=r[2&s[0]?"return":s[0]?"throw":"next"])&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[0,a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}},k=function(t){function e(e){var n=t.call(this,e)||this;return n.isHideSubmitting=function(){n.setState({isSubmitting:!1})},n.isResetProgressBar=function(){n.setState({isSubmitting:!0,progress:0,report:[]})},n.getReportData=function(t,e){var r=t.dataSourceIds,a=t.statusIds,s=t.index;return y.a.query({query:g.a,variables:{dataSourceIds:r,statusIds:a,limit:I.l.ITEMS_PER_PAGE,offset:(s-1)*I.l.ITEMS_PER_PAGE}}).then(function(t){var r=t.data,a=n.state,s=a.report,o=a.totalReportRecords,i=0;o>0&&(i=Math.floor(100*(r.report.length+s.length)/o)),n.setState({report:s.concat(r.report),progress:i<=100?i:0}),e()}).catch(function(t){console.error(t),e()})},n.handleSubmit=function(t){t.preventDefault(),n.props.form.validateFields(function(t,e){return E(n,void 0,void 0,function(){var n,r,a,s,o,i,u,c=this;return R(this,function(l){switch(l.label){case 0:if(t)return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),this.isResetProgressBar(),n=e.statusIds,r=e.dataSourceIds,[4,y.a.query({query:g.c,variables:{statusIds:n,dataSourceIds:r}})];case 2:if(a=l.sent().data,(s=a.totalReportRecords)<1)return this.isHideSubmitting(),[2,d.a.info({message:"L\u1ed7i",description:"Kh\xf4ng c\xf3 d\u1eef li\u1ec7u \u0111\u1ec3 l\u1ea5y"})];for(this.setState({totalReportRecords:s}),o=p.queue(1),i=1;i<=Math.ceil(s/I.l.ITEMS_PER_PAGE);i++)o.defer(this.getReportData,{dataSourceIds:r,statusIds:n,index:i});return o.awaitAll(function(){var t=c.state.report,e=Object(b.v)(t,Object(b.t)(c.props.userLoggedIn.role.permissions,I.e.ADMIN));c.isHideSubmitting(),Object(b.n)(e,"customers","report"+h(Date.now()).format("DDMMMYYYY").toString())}),[3,4];case 3:return u=l.sent(),console.error(u),Object(b.o)(u),[3,4];case 4:return[2]}})})})},n.state={statusIds:[0],dataSourceIds:[0],isSubmitting:!1,report:[],progress:0,totalReportRecords:0},n}return w(e,t),e.prototype.render=function(){var t={name:"/reports/group/customers",label:"B\xe1o c\xe1o nh\xf3m",breadCumData:[{id:1,text:"Trang Ch\u1ee7",link:"/"},{id:2,text:"B\xe1o c\xe1o nh\xf3m",link:"/reports/group/customers"}]},e=this.props,n=e.form,r=e.data,d=r.loading,p=r.statuses,h=r.dataSources;return f.createElement("div",null,f.createElement(l.a,{className:"content-header"},t.label,f.createElement(_.c,{breadCumData:t.breadCumData})),f.createElement(l.a,{className:"content-body animated fadeIn"},d?f.createElement(_.o,{size:"large"}):f.createElement("div",null,f.createElement(c.a,{percent:this.state.progress,status:"active"}),f.createElement(u.a,{onSubmit:this.handleSubmit},f.createElement(l.a,{gutter:16},f.createElement(i.a,{xs:24,sm:24,md:24,lg:10},f.createElement(u.a.Item,{label:"Tr\u1ea1ng th\xe1i"},n.getFieldDecorator("statusIds",{rules:[{required:!0,message:"H\xe3y nh\u1eadp tr\u1ea1ng th\xe1i"}]})(f.createElement(o.a,{mode:"multiple"},p&&p.map(function(t){return f.createElement(o.a.Option,{key:t.id,value:t.id},t.name)}))))),f.createElement(i.a,{xs:24,sm:24,md:24,lg:10},f.createElement(u.a.Item,{label:"Ngu\u1ed3n"},n.getFieldDecorator("dataSourceIds",{rules:[{required:!0,message:"H\xe3y nh\u1eadp ngu\u1ed3n"}]})(f.createElement(o.a,{mode:"multiple"},h.map(function(t){return f.createElement(o.a.Option,{key:t.id,value:t.id},t.name)}))))),f.createElement(i.a,{xs:24,sm:24,md:24,lg:4},f.createElement(u.a.Item,null,f.createElement(s.a,{type:"primary",htmlType:"submit",loading:this.state.isSubmitting,disabled:Object(b.z)(this.props)},f.createElement(a.a,{type:"download"}),"L\u1ea5y d\u1eef li\u1ec7u"))))))))},e}(f.PureComponent);e.a=Object(m.compose)(Object(v.connect)(function(t,e){return S({userLoggedIn:t.auth.userLoggedIn},e)},null),Object(m.graphql)(g.b),u.a.create())(k)},2813:function(t,e,n){"use strict";n.d(e,"b",function(){return l}),n.d(e,"a",function(){return f}),n.d(e,"c",function(){return d});var r,a,s,o=n(128),i=n.n(o),u=n(160),c=this&&this.__makeTemplateObject||function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},l=i()(r||(r=c(["\n  query StatusReportQueries {\n    dataSources {\n      id\n      name\n    }\n    statuses {\n      id\n      name\n    }\n  }\n"],["\n  query StatusReportQueries {\n    dataSources {\n      id\n      name\n    }\n    statuses {\n      id\n      name\n    }\n  }\n"]))),d=i()(a||(a=c(["\n  query TotalRecordReportQuery($statusIds: [ID!], $dataSourceIds: [ID!]) {\n    totalReportRecords(statusIds: $statusIds, dataSourceIds: $dataSourceIds)\n  }\n"],["\n  query TotalRecordReportQuery($statusIds: [ID!], $dataSourceIds: [ID!]) {\n    totalReportRecords(statusIds: $statusIds, dataSourceIds: $dataSourceIds)\n  }\n"]))),f=i()(s||(s=c(["\n  ","\n  query RecordReportQuery(\n    $statusIds: [ID!]\n    $dataSourceIds: [ID!]\n    $limit: Int!\n    $offset: Int!\n  ) {\n    report(\n      statusIds: $statusIds\n      dataSourceIds: $dataSourceIds\n      limit: $limit\n      offset: $offset\n    ) {\n      ...Customer\n      user {\n        id\n        name\n        licenseNumber\n        supervisor {\n          id\n          name\n          phoneNumber\n        }\n      }\n    }\n  }\n"],["\n  ","\n  query RecordReportQuery(\n    $statusIds: [ID!]\n    $dataSourceIds: [ID!]\n    $limit: Int!\n    $offset: Int!\n  ) {\n    report(\n      statusIds: $statusIds\n      dataSourceIds: $dataSourceIds\n      limit: $limit\n      offset: $offset\n    ) {\n      ...Customer\n      user {\n        id\n        name\n        licenseNumber\n        supervisor {\n          id\n          name\n          phoneNumber\n        }\n      }\n    }\n  }\n"])),u.c)}});